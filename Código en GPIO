#include <gpio.h>

#define SUMA 21
#define RESTA 19
#define CAMBIO 18
#define LED1 25
#define LED2 26
#define LED3 27
#define LED4 14

int contador = 0;
int antes = 1;
int actual = 0;
int futuro = 1;

void setup() {
  Serial.begin(9600); // Initialize serial communication for debugging
  gpio_set_direction(CAMBIO, GPIO_MODE_INPUT);
  gpio_set_pull_mode(CAMBIO, GPIO_PULLUP_ONLY);
  
  gpio_set_direction(RESTA, GPIO_MODE_INPUT);
  gpio_set_pull_mode(RESTA, GPIO_FLOATING);
  
  gpio_set_direction(SUMA, GPIO_MODE_INPUT);
  gpio_set_pull_mode(SUMA, GPIO_PULLDOWN_ONLY);
  
  gpio_set_direction(LED1, GPIO_MODE_OUTPUT);
  gpio_set_direction(LED2, GPIO_MODE_OUTPUT);
  gpio_set_direction(LED3, GPIO_MODE_OUTPUT);
  gpio_set_direction(LED4, GPIO_MODE_OUTPUT);
  
  gpio_set_level(LED1, 0);
  gpio_set_level(LED2, 0);
  gpio_set_level(LED3, 0);
  gpio_set_level(LED4, 0);
}

void loop() {
  int sumaState = gpio_get_level(SUMA);
  int restaState = gpio_get_level(RESTA);
  int cambioState = gpio_get_level(CAMBIO);
  
  Serial.print("SUMA: ");
  Serial.print(sumaState);
  Serial.print(" RESTA: ");
  Serial.print(restaState);
  Serial.print(" CAMBIO: ");
  Serial.println(cambioState);
  delay(200);
  
  if (cambioState == 0) {
    antes = actual;
    actual = futuro;
    futuro = antes;
    contador = 0;
  }

  if (actual == 1) {
    if (sumaState) {
      contador++;
    } else if (restaState) {
      contador--;
    }
    if (contador > 15) {
      contador = 0;
    } else if (contador < 0) {
      contador = 0;
    }
    Serial.print(contador);

    gpio_set_level(LED1, contador & 1);
    gpio_set_level(LED2, (contador >> 1) & 1);
    gpio_set_level(LED3, (contador >> 2) & 1);
    gpio_set_level(LED4, (contador >> 3) & 1);
  } else if (actual == 0) {
    if (sumaState) {
      contador++;
    } else if (restaState) {
      contador--;
    }
    if (contador > 4) {
      contador = 0;
    } else if (contador < 0) {
      contador = 0;
    }
    Serial.print(contador);

    gpio_set_level(LED1, contador == 1);
    gpio_set_level(LED2, contador == 2);
    gpio_set_level(LED3, contador == 3);
    gpio_set_level(LED4, contador == 4);
  }
}
